<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #222;
        }
        canvas {
            display: block;
            margin: auto;
        }
    </style>
</head>
<body>
    <script>
        let fps = 7;
        let windowWidth = 640;
        let windowHeight = 480;
        let cellSize = 40;
        let cellWidth = Math.floor(windowWidth / cellSize);
        let cellHeight = Math.floor(windowHeight / cellSize);

        let UP = 'up';
        let DOWN = 'down';
        let LEFT = 'left';
        let RIGHT = 'right';

        let HEAD = 0;
        let wormCoords;
        let direction;
        let apple;
        let score;

        function setup() {
            createCanvas(windowWidth, windowHeight);
            frameRate(fps);
            resetGame(); // Zavolejte resetGame místo přímo nastavení
        }

        function resetGame() {
            direction = RIGHT;
            score = 0; // Inicializace skóre
            let startx = Math.floor(random(5, cellWidth - 6));
            let starty = Math.floor(random(5, cellHeight - 6));

            wormCoords = [
                { x: startx, y: starty },
                { x: startx - 1, y: starty },
                { x: startx - 2, y: starty }
            ];

            apple = getRandomLocation();
            loop(); // Restartujte vykreslování
        }

        function draw() {
            background(0);
            drawGrid();
            drawWorm();
            drawApple();
            drawScore(); // Zobrazit skóre

            let pre_direction = direction;

            // Control handling
            if (keyIsDown(LEFT_ARROW) && direction !== RIGHT) {
                direction = LEFT;
            } else if (keyIsDown(RIGHT_ARROW) && direction !== LEFT) {
                direction = RIGHT;
            } else if (keyIsDown(UP_ARROW) && direction !== DOWN) {
                direction = UP;
            } else if (keyIsDown(DOWN_ARROW) && direction !== UP) {
                direction = DOWN;
            }

            if (!examineDirection(direction, pre_direction)) {
                direction = pre_direction;
            }

            moveWorm();
            
            // Check for eating apple
            if (wormCoords[HEAD].x === apple.x && wormCoords[HEAD].y === apple.y) {
                apple = getRandomLocation();
                score++; // Zvyšování skóre při snědení jablka
            } else {
                wormCoords.pop(); // Remove tail segment if not eating
            }
        }

        function examineDirection(temp, direction) {
            if (direction === UP && temp === DOWN) return false;
            if (direction === DOWN && temp === UP) return false;
            if (direction === LEFT && temp === RIGHT) return false;
            if (direction === RIGHT && temp === LEFT) return false;
            return true;
        }

        function moveWorm() {
            let newHead;
            if (direction === UP) {
                newHead = { x: wormCoords[HEAD].x, y: wormCoords[HEAD].y - 1 };
            } else if (direction === DOWN) {
                newHead = { x: wormCoords[HEAD].x, y: wormCoords[HEAD].y + 1 };
            } else if (direction === LEFT) {
                newHead = { x: wormCoords[HEAD].x - 1, y: wormCoords[HEAD].y };
            } else if (direction === RIGHT) {
                newHead = { x: wormCoords[HEAD].x + 1, y: wormCoords[HEAD].y };
            }

            // Wrap around the edges
            if (newHead.x < 0) {
                newHead.x = cellWidth - 1;
            } else if (newHead.x >= cellWidth) {
                newHead.x = 0;
            }
            if (newHead.y < 0) {
                newHead.y = cellHeight - 1;
            } else if (newHead.y >= cellHeight) {
                newHead.y = 0;
            }

            wormCoords.unshift(newHead);

            // Check for self-collision
            for (let i = 1; i < wormCoords.length; i++) {
                if (wormCoords[i].x === newHead.x && wormCoords[i].y === newHead.y) {
                    noLoop(); // Zastavte vykreslování
                    let message = "Prohráli jste! Vaše skóre: " + score;
                    if (score >= 50) {
                        message += "\nGratulujeme, právě jste získali slevu 10%!";
                    }
                    else {
                        message += "\nBohužel jste nezískali alespoň 50 bodů, takže slevu 10% nezískáváte!"
                    }
                    alert(message);
                    resetGame(); // Restartujte hru
                    return; // Zabráníme pokračování po prohře
                }
            }
        }

        function drawGrid() {
            stroke(100);
            for (let x = 0; x <= windowWidth; x += cellSize) {
                line(x, 0, x, windowHeight);
            }
            for (let y = 0; y <= windowHeight; y += cellSize) {
                line(0, y, windowWidth, y);
            }
        }

        function drawWorm() {
            fill(0, 100, 0); // Tmavší barva pro hlavu hada
            rect(wormCoords[HEAD].x * cellSize, wormCoords[HEAD].y * cellSize, cellSize, cellSize);
            for (let i = 1; i < wormCoords.length; i++) {
                fill(0, 155, 0); // Barva pro tělo hada
                rect(wormCoords[i].x * cellSize, wormCoords[i].y * cellSize, cellSize, cellSize);
                fill(0, 255, 0);
                rect(wormCoords[i].x * cellSize + 4, wormCoords[i].y * cellSize + 4, cellSize - 8, cellSize - 8);
            }
        }

        function drawApple() {
            fill(255, 0, 0);
            rect(apple.x * cellSize, apple.y * cellSize, cellSize, cellSize);
        }

        function drawScore() {
            fill(255);
            textSize(16);
            text("Skóre: " + score, 10, 20);
        }

        function getRandomLocation() {
            let location;
            do {
                location = {
                    x: Math.floor(random(0, cellWidth)),
                    y: Math.floor(random(0, cellHeight))
                };
            } while (testNotOk(location, wormCoords));
            return location;
        }

        function testNotOk(temp, worm) {
            for (let body of worm) {
                if (temp.x === body.x && temp.y === body.y) {
                    return true;
                }
            }
            return false;
        }
    </script>
</body>
</html>
